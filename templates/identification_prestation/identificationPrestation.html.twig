{% extends 'base.html.twig' %}

{% block body %}


    {% if identificationPrestation is defined %}
        <div class="centered-content">
            <div class="my-2">
                <h2 class="text-2xl font-bold text-center text-black-500">Identification Prestation</h2>
            </div>
            <div class="max-w-sm mx-auto" id="divInfosIdentificationPrestation">
                <div class="mb-5">
                    <div style="display: flex ; justify-content: space-between" class="divSeparator">
                        <strong>Société : </strong> <span>{{ identificationPrestation.societe }}</span>
                    </div>
                </div>
                <div class="mb-5">
                    <div style="display: flex; justify-content: space-between" class="divSeparator">
                        <strong>Nom / Prénom : </strong> <span>{{ identificationPrestation.nomPrenom }}</span>
                    </div>
                </div>
                <div class="mb-5">
                    <div style="display: flex; justify-content: space-between" class="divSeparator">
                        <strong>Prestation : </strong> <span>{{ identificationPrestation.prestation }}</span>
                    </div>
                </div>
                <div class="mb-5">
                    <div style="display: flex; justify-content: space-between" class="divSeparator">
                        <strong>Commanditaire : </strong> <span>{{ identificationPrestation.commanditaire }}</span>
                    </div>
                </div>
                <div class="mb-5">
                    <div style="display: flex; justify-content: space-between" class="divSeparator">
                        <strong>Arrivé le, à : </strong> <span>{{ identificationPrestation.heureArrivee | date ('Y-m-d H:i:s' , 'Europe/Paris') }}</span>
                    </div>
                </div>
                <div class="mb-5" id="divSignature">
                    <canvas id="signature" width="100" height="100"></canvas>
                    <div>
                        <a href="#" id="effacerSignature"><button type="button" class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900">Effacer</button></a>
                        <a href="#" id="enregistrerSignature"><button type="button" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Enregistrer</button></a>

                    </div>
                </div>
            </div>

            <div>
                <a onclick="return confirm('Êtes vous sûr que la prestation est terminée ?')" href="{{ path('app_identification_prestation_validate' , { 'id' : identificationPrestation.id })  }}"><button class="hover:bg-orange-900 bg-orange-900 dark:hover:bg-orange-500 text-white font-bold py-2 px-4 rounded">Valider formulaire ?</button></a>
            </div>
        </div>


    {% else %}
        <div class="centered-content">
            <div class="my-2">
                <h2 class="text-2xl font-bold text-center text-black-500">Formulaire identification prestation</h2>
            </div>
            <div class="max-w-lg mx-auto" style="width: 25rem">
                {{ form_start(identificationPrestationForm) }}
                <div id="labelsInput">
                    <div class="mb-5">
                        <div style="display: flex" class="divSeparator">
                            <div class="inputSeparator">
                                {{ form_label(identificationPrestationForm.societe) }}
                            </div>
                            <div>
                                {{ form_widget(identificationPrestationForm.societe) }}
                            </div>
                        </div>
                        <div>
                            {{ form_errors(identificationPrestationForm.societe) }}
                        </div>
                    </div>
                    <div class="mb-5">
                        <div style="display: flex" class="divSeparator">
                            <div class="inputSeparator">
                                {{ form_label(identificationPrestationForm.nomPrenom) }}
                            </div>
                            <div>
                                {{ form_widget(identificationPrestationForm.nomPrenom) }}
                            </div>
                        </div>
                        <div>
                            {{ form_errors(identificationPrestationForm.nomPrenom) }}
                        </div>
                    </div>
                    <div class="mb-5">
                        <div style="display: flex" class="divSeparator">
                            <div class="inputSeparator">
                                {{ form_label(identificationPrestationForm.prestation) }}
                            </div>
                            <div>
                                {{ form_widget(identificationPrestationForm.prestation) }}
                            </div>
                        </div>
                        <div>
                            {{ form_errors(identificationPrestationForm.prestation) }}
                        </div>
                    </div>
                    <div class="mb-5">
                        <div style="display: flex" class="divSeparator">
                            <div class="inputSeparator">
                                {{ form_label(identificationPrestationForm.commanditaire) }}
                            </div>
                            <div>
                                {{ form_widget(identificationPrestationForm.commanditaire) }}
                            </div>
                        </div>
                        <div>
                            {{ form_errors(identificationPrestationForm.commanditaire) }}
                        </div>
                    </div>
                </div>
                <div>
                    {{ form_row( identificationPrestationForm.save) }}
                </div>

                {{ form_end(identificationPrestationForm) }}
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block title %}
    Formulaire | Identification | Prestation
{% endblock %}

{% block javascripts %}

    <script src="{{ asset('scripts/Signature.js') }}"></script>

    <script>
        //On a chargé en premier la classe Signature juste au dessus, et maintenant, au chargement de la page, on appelle les event listener
        window.onload = () => {
            let canvas = new Signature("#signature")

            document.querySelector('#effacerSignature').addEventListener( 'click' , ( event ) => {
                //Le preventDefault permet d'éviter que le lien s'active
                event.preventDefault();
                canvas.effacer()
            })

            document.querySelector('#enregistrerSignature').addEventListener( 'click' , ( event ) => {
                event.preventDefault();
                //On prépare les data à envoyer via le fetch
                let data = {
                    image : canvas.genererImg()
                }

                fetch('/identification_prestation/sign' , {
                    method : "POST" ,
                    body : JSON.stringify( data )
                }).then((response ) => {
                    console.log(response);
                })

            } )
        }
    </script>
{% endblock %}